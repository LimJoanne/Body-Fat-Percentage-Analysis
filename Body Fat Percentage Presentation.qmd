---
title: "Body Fat Percentage Presentation"
subtitle: "Group 013E01"
author: "Joanne Lim, John Fu, Haoyuan Gao, Zhenchen Yi"
format: 
  revealjs:
    auto-slide: 20000
    embed-resources: true
    css: custom.css
---

### Data Description

-   Accurately body fat measurement is vital but often inconvenient and expensive
-   Can we use simpler measurements like height, weight, and circumferences for estimates?
-   The data set [bodyfat](https://dasl.datadescription.com/datafile/bodyfat) contains body fat percentages and other related measurements for 250 men. These measurements, which include height, weight and various body circumferences, were collected to explore alternatives to underwater body fat assessments.

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
library(ggplot2)
bodyfat <- read.table("bodyfat.txt", header = TRUE)
glimpse(bodyfat)
library(stats)
```

---

### Data Cleaning
We noticed that Height and Weight in the file was in inches and pounds respectively. However, we need to calculate BMI for later use and BMI formula is: $BMI = \frac{Weight(kg)}{Height(m)^2}$. 
```{r}
bodyfat$Height <- bodyfat$Height * 0.0254
bodyfat$Weight <- bodyfat$Weight * 0.453592
```

Create a new column with BMI
```{r}
bodyfat$BMI <- bodyfat$Weight / (bodyfat$Height^2)
```

---
```{r, warning=FALSE}
library(ggplot2)

# List of independent variables
variables <- c("Density", "Age", "Weight", "Height", "Neck", "Chest", "Abdomen", "Hip", 
               "Thigh", "Knee", "Ankle", "Bicep", "Forearm", "Wrist")

# For each variable, create and display a scatter plot against Pct.BF
for (var in variables) {
  plot <- ggplot(bodyfat, aes(x = .data[[var]], y = Pct.BF)) +
      geom_point() +
      geom_smooth(method = "lm", color = "blue", se = FALSE) +  # Adding the blue regression line
      labs(title = paste("Scatterplot of", var, "vs Pct.BF"),
           x = var,
           y = "Pct.BF") +
      theme_minimal()
  print(plot)
}
```
```{r}
library(ggplot2)

# List of independent variables
variables <- c("Density", "Age", "Weight", "Height", "Neck", "Chest", "Abdomen", "Hip", 
               "Thigh", "Knee", "Ankle", "Bicep", "Forearm", "Wrist")

# Loop through each variable, fit a model, and then plot the residuals
for (var in variables) {
  # Construct formula using paste
  formula_str <- paste("Pct.BF ~", var)
  model <- lm(formula_str, data=bodyfat)
  
  # Compute the residuals
  residuals <- residuals(model)
  
  # Create the plot
  plot <- ggplot(bodyfat, aes_string(x=var, y=residuals)) +
    geom_point() +
    geom_hline(yintercept=0, color="blue") + 
    labs(title=paste("Residual Plot for", var),
         x=var,
         y="Residuals") +
    theme_minimal()
  
  print(plot)
}

```


### Model Selection 

```{r}
M0 = lm(Pct.BF ~ ., data = bodyfat) #full model
M1 = lm(Pct.BF ~ 1, data = bodyfat) #null model

step.back.aic = step(M0,
                     direction = "backward",
                     trace = FALSE)
step.fwd.aic = step(M1, scope = list(lower = M1, upper = M0),
                    direction = "forward", trace = FALSE)

summary(step.back.aic)
summary(step.fwd.aic)
```

```{r}
bodyfat <- bodyfat %>% 
  filter(Pct.BF > 0)

#log linear
lm_log_linear <- lm(log(Pct.BF) ~ Age + BMI, data = bodyfat)
summary(lm_log_linear)
```

```{r}
#linear log

# Fitting the linear-log model
lm_linear_log <- lm(Pct.BF ~ log(Age) + log(BMI), data = bodyfat)

# Getting the summary
summary(lm_linear_log)

```

```{r}
#log-log
lm_log_log <- lm(log(Pct.BF) ~ log(Age) + log(BMI), data = bodyfat)

# Getting the summary
summary(lm_log_log)
```

```{r, warning=FALSE}
library(sjPlot)
tab_model(M0, step.back.aic, step.fwd.aic, lm3, lm_linear_log, lm_log_log,
          dv.labels = c("Full", "Backward", "Forward", "Log-Linear", "Linear-Log", "Log-Log"),
          show.ci = F, show.aic=T)
```




