---
title: "Body Fat Percentage Presentation"
subtitle: "Group 013E01"
author: "Joanne Lim, John Fu, Haoyuan Gao, Zhenchen Yi"
format:
  revealjs:
    # self-contained: true
    fig-format: retina
    toc: true
    toc-depth: 1
    number-sections: false
    toc-title: "In this lecture"
    theme: [default, "sydney.scss"]
    code-line-numbers: false
    embed-resources: true
    slide-number: c
    scrollable: true
    smaller: true
    pdf-max-pages-per-slide: 1
    history: false # don't add each slide to browser history
    auto-slide: 20000
bibliography: pres_bib.bib
csl: apa-old-doi-prefix.csl
execute:
  echo: false
---

## Data Description

-   Accurately body fat measurement is vital but often inconvenient and expensive
-   Can we use simpler measurements like height, weight, and circumferences for estimates?
-   The data set [bodyfat](https://dasl.datadescription.com/datafile/bodyfat) contains body fat percentages and other related measurements for 250 men. These measurements, which include height, weight and various body circumferences, were collected to explore alternatives to underwater body fat assessments.

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
library(ggplot2)
bodyfat <- read.table("bodyfat.txt", header = TRUE)
glimpse(bodyfat)
library(stats)
```


## Check Linearity

```{r, warning=FALSE, message=FALSE}
library(gridExtra)
library(ggplot2)

# List of independent variables
variables <- c("Density", "Age", "Weight", "Height", "Neck", "Chest", "Abdomen", "Hip", "Thigh", "Knee", "Ankle", "Bicep", "Forearm", "Wrist")

# Create a list to store all plots
plot_list <- list()

# Loop through each variable, fit a model, and then store the residual plot in the list
for (i in seq_along(variables)) {
  var <- variables[i]
  
  # Construct formula using paste
  formula_str <- paste("Pct.BF ~", var)
  model <- lm(formula_str, data=bodyfat)
  
  # Compute the residuals
  residuals <- residuals(model)
  
  # Create the plot
  plot <- ggplot(bodyfat, aes_string(x=var, y=residuals)) +
    geom_point() +
    geom_hline(yintercept=0, color="red") + 
    geom_smooth(method="loess", se=FALSE, color="blue") +
    labs(title=paste("Residual Plot for", var),
         x=var,
         y="Residuals") +
    theme_minimal() +
    theme(text = element_text(size = 8))
  
  # Add the plot to the list
  plot_list[[i]] <- plot
}

# Arrange all the plots on one page
grid.arrange(grobs=plot_list, ncol=4)  # Adjust ncol for desired number of columns
```


## Null and Full Model

```{r}
M0 = lm(Pct.BF ~ ., data = bodyfat) #full model
M1 = lm(Pct.BF ~ 1, data = bodyfat) #null model

summary(M0, data = bodyfat)
```

## Backward and Forward stepwise selection

```{r}
step.back.aic = step(M0,
                     direction = "backward",
                     trace = FALSE)
step.fwd.aic = step(M1, scope = list(lower = M1, upper = M0),
                    direction = "forward", trace = FALSE)

summary(step.back.aic)
summary(step.fwd.aic)
```

```{r}
bodyfat <- bodyfat %>% 
  filter(Pct.BF > 0)

#log linear
lm_log_linear <- lm(log(Pct.BF) ~ Density + Age + Weight + Height + Neck + Chest + Abdomen + Waist + Hip + Thigh + Knee + Ankle + Bicep + Forearm + Wrist, data = bodyfat)
summary(lm_log_linear)
```

```{r}
#linear log

# Fitting the linear-log model
lm_linear_log <- lm(Pct.BF ~ Density + Age + Weight + Height + log(Neck) + Chest + log(Abdomen) + Waist + Hip + Thigh + Knee + log(Ankle) + log(Bicep) + log(Forearm) + Wrist, data = bodyfat)

```

```{r}
#log-log
lm_log_log <- lm(log(Pct.BF) ~ Density + Age + Weight + Height + log(Neck) + Chest + log(Abdomen) + Waist + Hip + Thigh + Knee + log(Ankle) + log(Bicep) + log(Forearm) + Wrist, data = bodyfat)
```

## Summary of all 5 models

- We observed that the relationship between Neck, Abdomen, Bicep, Forearm, Ankle, and Pct.BF has a non-linear relationship, so we will transform these variables when we perform linear-log and log-log models.
```{r, warning=FALSE, message=FALSE}
library(sjPlot)
tab_model(M0, step.back.aic, step.fwd.aic, lm_log_linear, lm_linear_log, lm_log_log, 
          dv.labels = c("Full", "Backward", "Forward", "Log-Linear", "Linear-Log", "Log-Log"),
          show.ci = F, show.aic = T)

```

## Model selection conclusion

- Generally, higher values of R-squared are better, but a very high R-squared could suggest overfitting, especially if it is much higher than the adjusted R-squared.
- Lower AIC values indicate a better-fitting model. 
- We can conclude from the table, backward selection model will be the most appropriate one as it has the lowest AIC values and its R-squared and adjusted R-squared is the same.
- Fitted model for the backward selection model:
$$Pct.BF = 442.38 - 406.49 \times Density + 0.01 \times Age + 0.06 \times Abdomen$$





